<%- include('../partials/header', { page: 'delivery-notes', pageGroup: 'sales' }) %>

<div class="container mt-4">
  <h1 class="fw-bold text-primary mb-4"><i class="bi bi-truck"></i> Nouveau Bon de Livraison</h1>

  <form action="/delivery-notes/add/<%= sale.id %>" method="POST" class="shadow-sm p-4 bg-light rounded">
    <div class="mb-3">
      <label class="form-label fw-bold">Client</label>
      <input type="text" class="form-control" value="<%= sale.customer_name %>" disabled>
    </div>

    <div class="mb-3">
      <label class="form-label">Date de livraison</label>
      <input type="date" class="form-control" name="delivery_date" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Statut</label>
      <select name="status" class="form-select" required>
        <option value="en attente">En attente</option>
        <option value="partiellement livré">Partiellement livré</option>
        <option value="livré">Livré</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Note (optionnel)</label>
      <textarea name="note" rows="3" class="form-control"></textarea>
    </div>

    <button type="submit" class="btn btn-primary">Créer le bon de livraison</button>
    <a href="/sales/history" class="btn btn-outline-secondary">Annuler</a>
  </form>

  <div class="mt-5">
    <h5 class="text-muted">Produits associés à la vente :</h5>
    <ul class="list-group">
      <% details.forEach(p => { %>
        <li class="list-group-item d-flex justify-content-between">
          <span><%= p.product_name %></span>
          <span><%= p.quantity %> x <%= p.unit_price.toLocaleString('fr-FR') %> FCFA</span>
        </li>
      <% }) %>
    </ul>
  </div>
</div>

<%- include('../partials/footer') %>
